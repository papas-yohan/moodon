# 🚀 배포 계획 및 전략

## 📋 목차
1. [배포 전략 개요](#배포-전략-개요)
2. [단계별 배포 계획](#단계별-배포-계획)
3. [배포 아키텍처](#배포-아키텍처)
4. [비용 분석](#비용-분석)
5. [배포 체크리스트](#배포-체크리스트)
6. [롤백 전략](#롤백-전략)
7. [모니터링 계획](#모니터링-계획)

---

## 배포 전략 개요

### 목표
- ✅ 빠른 MVP 배포 (1-2일)
- ✅ 최소 비용으로 시작
- ✅ 확장 가능한 구조
- ✅ 안정적인 운영

### 선택한 플랫폼
- **프론트엔드**: Vercel (무료)
- **백엔드**: Vercel Serverless (무료)
- **데이터베이스**: Supabase PostgreSQL (무료 500MB)
- **파일 스토리지**: Vercel Blob 또는 Cloudinary (무료)
- **메시지 발송**: Solapi (종량제)

---

## 단계별 배포 계획

### Phase 1: MVP 배포 (1-2일) ✅ 현재 단계

#### 목표
- 핵심 기능 배포
- 실제 사용자 테스트
- 피드백 수집

#### 작업 항목
```
Day 1: 인프라 설정
├── Supabase 프로젝트 생성
├── 데이터베이스 마이그레이션
├── Vercel 프로젝트 생성 (백엔드)
└── 환경 변수 설정

Day 2: 배포 및 테스트
├── 백엔드 배포
├── 프론트엔드 배포
├── 솔라피 API 설정
├── 전체 플로우 테스트
└── 문서 업데이트
```

#### 완료 기준
- [ ] 프론트엔드 접속 가능
- [ ] 백엔드 API 정상 동작
- [ ] 데이터베이스 연결 성공
- [ ] 실제 메시지 발송 성공
- [ ] 추적 시스템 동작

---

### Phase 2: 안정화 (1주일)

#### 목표
- 버그 수정
- 성능 최적화
- 사용자 피드백 반영

#### 작업 항목
```
Week 1: 안정화
├── 버그 수정
├── 성능 모니터링
├── 에러 로깅 개선
├── 사용자 피드백 수집
└── 문서 업데이트
```

#### 완료 기준
- [ ] 주요 버그 0건
- [ ] API 응답 시간 < 500ms
- [ ] 에러율 < 1%
- [ ] 사용자 만족도 > 80%

---

### Phase 3: 기능 확장 (2-4주)

#### 목표
- 추가 기능 개발
- UX 개선
- 성능 최적화

#### 작업 항목
```
Week 2-3: 기능 추가
├── QR 코드 생성
├── 로고 삽입 기능
├── 추가 템플릿
├── 배치 시스템
└── 통계 개선

Week 4: 최적화
├── 이미지 최적화
├── 데이터베이스 인덱스
├── 캐싱 전략
└── CDN 설정
```

#### 완료 기준
- [ ] 모든 추가 기능 배포
- [ ] 페이지 로드 < 2초
- [ ] 이미지 합성 < 5초
- [ ] 동시 사용자 100명 지원

---

### Phase 4: SaaS 전환 (1-3개월)

#### 목표
- 멀티 테넌시
- 구독 시스템
- 결제 연동

#### 작업 항목
```
Month 1: 인증 시스템
├── 회원가입/로그인
├── JWT 인증
├── 권한 관리
└── 사용자 프로필

Month 2: 구독 시스템
├── 플랜 관리
├── 결제 연동 (토스페이먼츠)
├── 사용량 제한
└── 청구 시스템

Month 3: 멀티 테넌시
├── 데이터 분리
├── API 키 관리
├── 관리자 기능
└── 보안 강화
```

#### 완료 기준
- [ ] 회원가입/로그인 동작
- [ ] 결제 시스템 동작
- [ ] 계정별 데이터 완전 분리
- [ ] 보안 감사 통과

---

## 배포 아키텍처

### Phase 1: MVP 아키텍처 (현재)

```
┌─────────────────┐
│   사용자        │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Vercel CDN     │  ← 프론트엔드 (React + Vite)
│  (Global Edge)  │     - 정적 파일 호스팅
└────────┬────────┘     - 자동 SSL
         │              - 무료 100GB/월
         ▼
┌─────────────────┐
│  Vercel         │  ← 백엔드 (NestJS Serverless)
│  Serverless     │     - API 엔드포인트
│  Functions      │     - 자동 스케일링
└────────┬────────┘     - 무료 100GB/월
         │
         ├──────────────┬──────────────┐
         │              │              │
         ▼              ▼              ▼
┌─────────────┐  ┌──────────────┐  ┌──────────────┐
│  Supabase   │  │ Vercel Blob  │  │   Solapi     │
│  PostgreSQL │  │   Storage    │  │   SMS/MMS    │
│  (500MB)    │  │   (무료)     │  │   (종량제)   │
└─────────────┘  └──────────────┘  └──────────────┘
```

### Phase 2: 안정화 아키텍처

```
┌─────────────────┐
│   사용자        │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Vercel CDN     │  + Vercel Analytics
│  + Edge Cache   │  + Error Tracking
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Vercel         │  + Sentry 에러 추적
│  Serverless     │  + 로그 수집
│  + Monitoring   │  + 성능 모니터링
└────────┬────────┘
         │
         ├──────────────┬──────────────┐
         │              │              │
         ▼              ▼              ▼
┌─────────────┐  ┌──────────────┐  ┌──────────────┐
│  Supabase   │  │  Cloudinary  │  │   Solapi     │
│  + Backup   │  │  + CDN       │  │  + Webhook   │
└─────────────┘  └──────────────┘  └──────────────┘
```

### Phase 3: 확장 아키텍처

```
┌─────────────────┐
│   사용자        │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  CloudFlare     │  ← CDN + DDoS 보호
│  CDN + WAF      │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Vercel         │  ← 프론트엔드
│  Edge Network   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  Load Balancer  │  ← 트래픽 분산
└────────┬────────┘
         │
    ┌────┴────┐
    ▼         ▼
┌────────┐ ┌────────┐
│Backend │ │Backend │  ← 백엔드 (다중 인스턴스)
│Node 1  │ │Node 2  │
└───┬────┘ └───┬────┘
    │          │
    └────┬─────┘
         │
    ┌────┴────┬──────────┬──────────┐
    ▼         ▼          ▼          ▼
┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐
│Primary │ │Replica │ │ Redis  │ │  S3    │
│  DB    │ │  DB    │ │ Cache  │ │Storage │
└────────┘ └────────┘ └────────┘ └────────┘
```

---

## 비용 분석

### Phase 1: MVP (무료 ~ 월 2만원)

| 서비스 | 플랜 | 비용 | 한도 |
|--------|------|------|------|
| **Vercel** | Hobby | 무료 | 100GB 대역폭/월 |
| **Supabase** | Free | 무료 | 500MB DB, 1GB 파일 |
| **Vercel Blob** | Hobby | 무료 | 500MB 저장 |
| **Solapi** | 종량제 | ~20,000원 | 월 1,000건 발송 |
| **총계** | - | **~20,000원/월** | - |

### Phase 2: 안정화 (월 5-10만원)

| 서비스 | 플랜 | 비용 | 한도 |
|--------|------|------|------|
| **Vercel** | Pro | $20 | 1TB 대역폭/월 |
| **Supabase** | Pro | $25 | 8GB DB, 100GB 파일 |
| **Cloudinary** | Plus | $99 | 75GB 저장, 75GB 대역폭 |
| **Sentry** | Team | $26 | 50K 이벤트/월 |
| **Solapi** | 종량제 | ~50,000원 | 월 2,500건 발송 |
| **총계** | - | **~100,000원/월** | - |

### Phase 3: 확장 (월 20-50만원)

| 서비스 | 플랜 | 비용 | 한도 |
|--------|------|------|------|
| **Vercel** | Enterprise | 협의 | 무제한 |
| **AWS RDS** | db.t3.medium | $60 | 2 vCPU, 4GB RAM |
| **AWS EC2** | t3.medium x2 | $60 | 2 vCPU, 4GB RAM x2 |
| **AWS S3** | Standard | $23 | 1TB 저장 |
| **CloudFlare** | Pro | $20 | CDN + WAF |
| **Solapi** | 종량제 | ~200,000원 | 월 10,000건 발송 |
| **총계** | - | **~500,000원/월** | - |

---

## 배포 체크리스트

### 사전 준비
- [ ] GitHub 저장소 생성
- [ ] Vercel 계정 생성
- [ ] Supabase 계정 생성
- [ ] Solapi 계정 생성 및 API 키 발급
- [ ] 도메인 구매 (선택)

### 데이터베이스
- [ ] Supabase 프로젝트 생성
- [ ] 데이터베이스 URL 확인
- [ ] Prisma 마이그레이션 실행
- [ ] 초기 데이터 입력 (선택)
- [ ] 백업 설정

### 백엔드 배포
- [ ] Vercel 프로젝트 생성
- [ ] 환경 변수 설정
- [ ] vercel.json 설정
- [ ] 배포 실행
- [ ] Health Check 확인
- [ ] API 문서 확인

### 프론트엔드 배포
- [ ] Vercel 프로젝트 생성
- [ ] 환경 변수 설정
- [ ] API URL 설정
- [ ] 배포 실행
- [ ] 페이지 로드 확인
- [ ] 기능 테스트

### 솔라피 설정
- [ ] 설정 페이지 접속
- [ ] API 키 입력
- [ ] 발신번호 입력
- [ ] 설정 저장
- [ ] 테스트 발송

### 모니터링
- [ ] Vercel Analytics 활성화
- [ ] Sentry 설정 (선택)
- [ ] 로그 수집 설정
- [ ] 알림 설정

### 문서화
- [ ] README 업데이트
- [ ] API 문서 업데이트
- [ ] 사용자 가이드 작성
- [ ] 배포 가이드 작성

---

## 롤백 전략

### 자동 롤백 (Vercel)

Vercel은 자동으로 이전 배포 버전을 유지합니다.

```bash
# 1. Vercel 대시보드에서 Deployments 확인
# 2. 이전 배포 선택
# 3. "Promote to Production" 클릭
```

### 수동 롤백 (Git)

```bash
# 1. 이전 커밋으로 되돌리기
git revert HEAD

# 2. 푸시하여 자동 배포
git push origin main

# 또는 특정 커밋으로 롤백
git reset --hard <commit-hash>
git push -f origin main
```

### 데이터베이스 롤백

```bash
# 1. Supabase 대시보드에서 백업 확인
# 2. 특정 시점으로 복원
# 3. 또는 Prisma 마이그레이션 롤백
npx prisma migrate resolve --rolled-back <migration-name>
```

---

## 모니터링 계획

### 1. 성능 모니터링

#### Vercel Analytics
```
- 페이지 로드 시간
- Core Web Vitals
- 사용자 경로 분석
```

#### 커스텀 메트릭
```typescript
// API 응답 시간 측정
@Injectable()
export class PerformanceInterceptor implements NestInterceptor {
  intercept(context: ExecutionContext, next: CallHandler): Observable<any> {
    const start = Date.now();
    return next.handle().pipe(
      tap(() => {
        const duration = Date.now() - start;
        console.log(`Request took ${duration}ms`);
      }),
    );
  }
}
```

### 2. 에러 모니터링

#### Sentry 설정
```typescript
import * as Sentry from '@sentry/nestjs';

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  environment: process.env.NODE_ENV,
  tracesSampleRate: 1.0,
});
```

#### 커스텀 에러 로깅
```typescript
@Catch()
export class AllExceptionsFilter implements ExceptionFilter {
  catch(exception: unknown, host: ArgumentsHost) {
    // Sentry에 에러 전송
    Sentry.captureException(exception);
    
    // 로그 기록
    console.error('Exception:', exception);
  }
}
```

### 3. 비즈니스 메트릭

#### 주요 지표
```
- 일일 활성 사용자 (DAU)
- 월간 활성 사용자 (MAU)
- 메시지 발송 수
- 메시지 성공률
- 클릭률 (CTR)
- 전환율
```

#### 대시보드
```
Supabase → Reports
- 데이터베이스 사용량
- API 요청 수
- 에러율

Vercel → Analytics
- 페이지 뷰
- 사용자 수
- 성능 지표
```

### 4. 알림 설정

#### 중요 알림
```
- 서버 다운 (5분 이상)
- 에러율 > 5%
- API 응답 시간 > 2초
- 데이터베이스 사용량 > 80%
- 발송 실패율 > 10%
```

#### 알림 채널
```
- 이메일
- Slack
- SMS (중요한 경우)
```

---

## 보안 체크리스트

### 애플리케이션 보안
- [ ] HTTPS 강제
- [ ] CORS 설정
- [ ] Rate Limiting
- [ ] SQL Injection 방지
- [ ] XSS 방지
- [ ] CSRF 방지
- [ ] 환경 변수 암호화
- [ ] API 키 암호화

### 데이터베이스 보안
- [ ] 강력한 비밀번호
- [ ] IP 화이트리스트 (필요시)
- [ ] 정기 백업
- [ ] 암호화된 연결
- [ ] 최소 권한 원칙

### 인프라 보안
- [ ] Vercel 2FA 활성화
- [ ] GitHub 2FA 활성화
- [ ] Supabase 2FA 활성화
- [ ] 정기 보안 감사
- [ ] 의존성 업데이트

---

## 성능 최적화 계획

### 프론트엔드
```
- [ ] 코드 스플리팅
- [ ] 이미지 최적화
- [ ] 레이지 로딩
- [ ] 캐싱 전략
- [ ] CDN 활용
```

### 백엔드
```
- [ ] 데이터베이스 인덱스
- [ ] 쿼리 최적화
- [ ] 캐싱 (Redis)
- [ ] 비동기 처리
- [ ] 배치 처리
```

### 데이터베이스
```
- [ ] 인덱스 최적화
- [ ] 쿼리 최적화
- [ ] 연결 풀링
- [ ] 읽기 복제본 (필요시)
```

---

## 다음 단계

### 즉시 실행 (1-2일)
1. **Supabase 프로젝트 생성**
2. **Vercel 배포 설정**
3. **환경 변수 설정**
4. **배포 실행**
5. **테스트 및 검증**

### 단기 (1주일)
1. **모니터링 설정**
2. **에러 추적 설정**
3. **성능 최적화**
4. **문서 업데이트**

### 중기 (1개월)
1. **추가 기능 개발**
2. **사용자 피드백 반영**
3. **성능 개선**
4. **보안 강화**

---

## 참고 문서

- [Vercel 배포 가이드](./VERCEL_DEPLOYMENT_GUIDE.md) - 상세 배포 절차
- [솔라피 설정 가이드](./SOLAPI_SETUP_GUIDE.md) - API 키 설정
- [프로젝트 상태](./PROJECT_STATUS.md) - 현재 진행 상황

---

**작성자**: Kiro AI  
**작성일**: 2025-11-08  
**버전**: 1.0.0  
**상태**: ✅ 완료
