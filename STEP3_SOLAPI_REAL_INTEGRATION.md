# 3️⃣ 단계 3: 솔라피 API 실제 연동

**예상 시간**: 30분  
**난이도**: 중간  
**위험도**: 낮음 (테스트 발송만 진행)  
**예상 비용**: 5,000원 (초기 충전)

---

## 🎯 기대효과

### Before (현재)
```
발송 모드:        시뮬레이션 (90% 성공률 가정)
실제 발송:        불가능
통계 정확도:      시뮬레이션 데이터
비즈니스:         테스트만 가능
```

### After (작업 후)
```
발송 모드:        실제 발송
실제 발송:        SMS/MMS/카카오톡 가능
통계 정확도:      100% 실제 데이터
비즈니스:         실제 운영 가능
```

### 📊 비즈니스 가치
```
✅ 실제 고객에게 메시지 발송 가능
✅ 정확한 발송 통계 수집
✅ 실제 비즈니스 운영 시작
✅ ROI 측정 가능
```

---

## ⚠️ 주의사항 및 사이드이펙트

### ✅ 안전한 작업
- 기존 기능에 영향 없음
- 데이터 손실 없음
- 시뮬레이션 모드로 롤백 가능
- 테스트 발송만 진행 (소량)

### ⚠️ 확인 필요
- 💰 **비용 발생**: SMS 8원/건, MMS 16원/건, 카카오톡 9-15원/건
- 📱 **발신번호 등록**: 본인인증 필요
- ⏰ **승인 시간**: 즉시~1일 (통신사 확인)
- 🔐 **API 키 보안**: 절대 공개하지 말 것

### 💰 예상 비용
```
초기 충전:        5,000원 (권장)
테스트 발송:      10건 × 16원 = 160원
여유 크레딧:      4,840원 (약 300건 발송 가능)
```

### 🔍 사이드이펙트
- ❌ 기존 기능 영향: 없음
- ❌ 데이터 손실: 없음
- ✅ 비용 발생: 사용량에 따라
- ✅ 롤백 가능: API 키 삭제 시 시뮬레이션 모드로

---

## 📋 실행 단계

### Step 1: 솔라피 계정 생성

1. **솔라피 웹사이트 접속**
   ```
   https://solapi.com
   ```

2. **회원가입**
   - "무료로 시작하기" 클릭
   - 이메일, 비밀번호 입력
   - 이메일 인증

3. **본인인증**
   - 휴대폰 본인인증 진행
   - 필수 단계 (발신번호 등록 위해)

---

### Step 2: 발신번호 등록

1. **콘솔 접속**
   ```
   https://console.solapi.com
   ```

2. **발신번호 관리**
   - 왼쪽 메뉴 → "발신번호 관리"
   - "발신번호 추가" 클릭

3. **번호 등록**
   ```
   전화번호:     본인 휴대폰 번호 (예: 010-1234-5678)
   용도:         마케팅 또는 일반
   ```

4. **인증 진행**
   - SMS 인증 또는 서류 인증
   - 휴대폰: 즉시 인증 가능
   - 일반 전화: 서류 제출 필요 (1일 소요)

5. **승인 대기**
   - 휴대폰: 즉시 승인
   - 일반 전화: 1영업일 소요

---

### Step 3: API 키 발급

1. **API 설정 메뉴**
   - 왼쪽 메뉴 → "API 설정"
   - 또는 "개발자 센터"

2. **API Key 생성**
   - "API Key 생성" 버튼 클릭
   - 키 이름 입력 (예: "Moodon Production")

3. **API 키 정보 복사**
   ```
   API Key:     NCSXXXXXXXXXXXXXXXXX (20자)
   API Secret:  HIUXXXXXXXXXXXXXXXXXXXXXXXXX (32자)
   ```

   ⚠️ **중요**: API Secret은 한 번만 표시됩니다!
   - 안전한 곳에 저장
   - 절대 공개하지 말 것
   - 분실 시 재발급 필요

---

### Step 4: 크레딧 충전

1. **충전하기**
   - 상단 메뉴 → "충전하기"
   - 또는 "크레딧 관리"

2. **충전 금액 선택**
   ```
   권장 금액:    5,000원
   결제 방법:    신용카드, 계좌이체, 무통장입금
   ```

3. **결제 진행**
   - 결제 정보 입력
   - 결제 완료

4. **크레딧 확인**
   - 대시보드에서 잔액 확인
   - 5,000원 = 약 300건 MMS 발송 가능

---

### Step 5: 웹 UI에서 API 키 설정

#### 로컬 환경 (개발)

1. **로컬 서버 실행**
   ```bash
   # 백엔드
   cd backend
   npm run start:dev

   # 프론트엔드 (새 터미널)
   cd frontend
   npm run dev
   ```

2. **설정 페이지 접속**
   ```
   http://localhost:5173/settings
   ```

3. **Solapi API 탭 선택**

4. **API 키 입력**
   ```
   API Key:     [Step 3에서 복사한 API Key]
   API Secret:  [Step 3에서 복사한 API Secret]
   발신번호:     [Step 2에서 등록한 번호, 예: 01012345678]
   ```

5. **저장 버튼 클릭**
   - 성공 메시지 확인
   - 데이터베이스에 암호화되어 저장됨

#### 프로덕션 환경 (Vercel)

1. **프로덕션 URL 접속**
   ```
   https://[vercel-domain]/settings
   ```

2. **동일하게 API 키 입력 및 저장**

---

### Step 6: 테스트 발송

1. **연락처 추가**
   - 연락처 페이지 이동
   - "연락처 추가" 클릭
   - 본인 전화번호 입력
   ```
   이름:         테스트
   전화번호:     010-1234-5678 (본인 번호)
   그룹:         테스트
   ```

2. **테스트 상품 준비**
   - 상품 페이지 이동
   - 기존 상품 선택 또는 새 상품 등록
   - 이미지 합성 완료 확인

3. **발송 페이지 이동**
   - "발송" 메뉴 클릭

4. **발송 설정**
   ```
   상품 선택:     테스트 상품
   연락처 선택:   본인 번호
   채널:          MMS (이미지 포함)
   메시지:        기본 템플릿 사용
   ```

5. **발송 실행**
   - "발송하기" 버튼 클릭
   - 확인 팝업에서 "확인" 클릭

6. **발송 결과 확인**
   - 발송 모니터 페이지로 자동 이동
   - 진행률 확인 (0% → 100%)
   - 성공/실패 건수 확인

7. **메시지 수신 확인**
   - 본인 휴대폰에서 메시지 수신 확인
   - 이미지 표시 확인
   - 추적 URL 클릭 테스트

---

## ✅ 완료 체크리스트

### 계정 설정
- [ ] 솔라피 계정 생성
- [ ] 본인인증 완료
- [ ] 발신번호 등록 및 승인
- [ ] API 키 발급
- [ ] 크레딧 충전 (5,000원)

### 시스템 설정
- [ ] 웹 UI에서 API 키 저장 (로컬)
- [ ] 웹 UI에서 API 키 저장 (프로덕션)
- [ ] 설정 저장 성공 확인

### 테스트 발송
- [ ] 본인 연락처 추가
- [ ] 테스트 상품 준비
- [ ] MMS 발송 실행
- [ ] 메시지 수신 확인
- [ ] 추적 URL 동작 확인
- [ ] 통계 업데이트 확인

---

## 🧪 테스트 시나리오

### 시나리오 1: SMS 발송 (텍스트만)
```
1. 연락처: 본인 번호
2. 채널: SMS
3. 메시지: "테스트 메시지입니다"
4. 예상 비용: 8원
5. 예상 시간: 즉시
```

### 시나리오 2: MMS 발송 (이미지 포함)
```
1. 연락처: 본인 번호
2. 채널: MMS
3. 상품: 이미지 합성된 상품
4. 예상 비용: 16원
5. 예상 시간: 즉시
```

### 시나리오 3: 카카오톡 발송 (향후)
```
1. 카카오톡 채널 연동 필요
2. 템플릿 등록 필요
3. 예상 비용: 9-15원
4. 설정 시간: 1-2일
```

---

## 🚨 문제 발생 시 대응

### 문제 1: API 키 저장 실패
```
증상: "API 키 저장에 실패했습니다"

해결:
1. API Key, Secret 재확인
2. 공백 없는지 확인
3. 백엔드 로그 확인
4. 데이터베이스 연결 확인
```

### 문제 2: 발송 실패
```
증상: "발송에 실패했습니다"

원인 및 해결:
1. 크레딧 부족
   → 충전하기

2. 발신번호 미승인
   → 승인 대기 또는 재등록

3. API 키 오류
   → 재발급 및 재설정

4. 수신번호 형식 오류
   → 010-1234-5678 형식 확인
```

### 문제 3: 메시지 수신 안 됨
```
증상: 발송 성공했지만 메시지 안 옴

해결:
1. 스팸 차단 확인
2. 수신번호 재확인
3. 통신사 문제 (5분 대기)
4. 솔라피 콘솔에서 발송 내역 확인
```

### 문제 4: 비용 과다 청구
```
증상: 예상보다 많은 비용 발생

해결:
1. 발송 내역 확인
2. 중복 발송 확인
3. 솔라피 고객센터 문의
```

---

## 🔄 롤백 방법

실제 발송을 중단하고 시뮬레이션 모드로 돌아가려면:

### 방법 1: API 키 삭제
1. 설정 페이지 접속
2. Solapi API 탭
3. API 키 필드 비우기
4. 저장 클릭

### 방법 2: 환경 변수 제거
```bash
# Railway Dashboard → Variables
# SOLAPI_API_KEY, SOLAPI_API_SECRET, SOLAPI_SENDER 삭제
```

**결과**: 시뮬레이션 모드로 자동 전환

---

## 📊 발송 통계 확인

### 대시보드에서 확인
```
✅ 총 발송 건수
✅ 성공/실패 건수
✅ 발송 비용
✅ 클릭률
✅ 시간대별 분석
```

### 솔라피 콘솔에서 확인
```
✅ 실제 발송 내역
✅ 크레딧 사용 내역
✅ 발송 상태 (성공/실패/대기)
✅ 실패 사유
```

---

## 💡 추가 최적화 팁

### 1. 발송 시간 최적화
```
최적 시간:
- 평일 오전 10시~12시
- 평일 오후 2시~5시
- 주말 오전 11시~오후 1시

피해야 할 시간:
- 새벽 (스팸 신고 위험)
- 심야 (법적 제한)
- 점심시간 직전/직후
```

### 2. 메시지 내용 최적화
```
✅ 짧고 명확한 메시지
✅ 행동 유도 문구 (CTA)
✅ 추적 URL 포함
✅ 수신거부 안내

❌ 과도한 이모지
❌ 스팸성 단어
❌ 너무 긴 메시지
```

### 3. 비용 절감 팁
```
1. SMS vs MMS 선택
   - 텍스트만: SMS (8원)
   - 이미지 필요: MMS (16원)

2. 대량 발송 시 할인
   - 솔라피 영업팀 문의
   - 월 1만건 이상 시 협의 가능

3. 카카오톡 활용
   - 친구 추가 시 저렴 (9원)
   - 템플릿 등록 필요
```

---

## 📈 다음 단계 (선택사항)

### 1. 카카오톡 채널 연동
```
1. 카카오톡 비즈니스 계정 생성
2. 솔라피에서 채널 연동
3. 메시지 템플릿 등록
4. 승인 대기 (1-2일)
5. 카카오톡 발송 테스트
```

### 2. 자동화 설정
```
1. 예약 발송 설정
2. 반복 발송 설정
3. 조건부 발송 설정
4. A/B 테스트 설정
```

### 3. 고급 분석
```
1. 코호트 분석
2. 퍼널 분석
3. ROI 계산
4. 최적화 인사이트
```

---

## 🎉 완료!

축하합니다! 이제 실제 SMS/MMS 발송이 가능합니다!

### 다음 액션
1. ☕ 잠시 휴식
2. 📊 발송 통계 모니터링
3. 🎯 실제 고객에게 발송 시작
4. 📈 성과 분석 및 최적화

---

## 📞 지원 및 문의

### 솔라피 고객센터
```
이메일:   support@solapi.com
전화:     1600-5856
운영시간: 평일 10:00-18:00
```

### 기술 문서
```
API 문서:  https://docs.solapi.com
FAQ:       https://solapi.com/faq
가이드:    https://solapi.com/guides
```

---

**준비되셨나요? 솔라피 계정을 생성하고 실제 발송을 시작해보세요!** 🚀

완료하시면 전체 즉시 실행 계획이 완료됩니다!
